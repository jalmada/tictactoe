<html>
  <head>
    <meta charset="utf-8"/>
    <title>Canvas tutorial</title>
    
    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
  </head>
  <body>
    <canvas id="tictactoe" width="300" height="300"></canvas><br/>
    <button id="reset">Reset</button>
    <script type="text/javascript">


        Circle = function(x,y,radius){
            this.x = x;
            this.y = y;
            this.radius = radius;
            

            this.paint = (function(ctx){
                ctx.strokeStyle = "rgb(0,0,0)";
                ctx.beginPath();
                ctx.arc(this.x + this.radius, this.y + this.radius, this.radius - 12, 0,Math.PI + (Math.PI * 2) / 2, true)
                ctx.stroke();
            }).bind(this);
        }

        Cross = function(x,y,width, height){
            this.x = x + 12;
            this.y = y + 12;
            this.width = width -24;
            this.height = height -24;

            this.paint = (function(ctx){
                ctx.strokeStyle = "rgb(0,0,0)";
                ctx.lineWidth=10;
                ctx.beginPath();
                ctx.moveTo(this.x,this.y);
                ctx.lineTo(this.x + this.width,this.y + this.height);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(this.x + this.width,this.y);
                ctx.lineTo(this.x, this.y + this.height);
                ctx.stroke();
            }).bind(this);

        }

     

        Mesh = function(cellsx, cellsy, width, height){
            this.cellsx = cellsx;
            this.cellsy = cellsy;
            this.width = width;
            this.height = height;

            this.countVLines = cellsx - 1;
            this.countHLines = cellsy - 1;
            this.cellwidth = Math.ceil(width/cellsx);
            this.cellheight = Math.ceil(height/cellsy);

            this.paint = (function(ctx){
                for(var x = 0, xpos = this.cellwidth; x < this.countVLines; x++, xpos = xpos + this.cellwidth){
                    ctx.strokeStyle = "rgb(0,0,0)";
                    ctx.lineWidth=5;
                    ctx.beginPath();
                    ctx.moveTo(xpos,0);
                    ctx.lineTo(xpos, this.height);
                    ctx.stroke();
                }

                for(var y = 0, ypos = this.cellheight; y < this.countHLines; y++, ypos = ypos + this.cellheight){
                    ctx.strokeStyle = "rgb(0,0,0)";
                    ctx.lineWidth=5;
                    ctx.beginPath();
                    ctx.moveTo(0,ypos);
                    ctx.lineTo(this.width, ypos);
                    ctx.stroke();
                }           
            }).bind(this);  
        }

       

        TicTacToe = function(canvasId, xcells, ycells){

            this.canvasId = canvasId;
            this.canvas = document.getElementById(this.canvasId);

            this.ctx = this.canvas.getContext('2d');;

            this.xcells = xcells;
            this.ycells = ycells;
            
            this.elementWidth = Math.ceil(this.canvas.width / this.xcells);
            this.elementHeight = Math.ceil(this.canvas.height / this.ycells);
            this.elementRadius = Math.ceil((this.canvas.width / this.xcells)/2);

            this.currentShape = 1;
            this.shapeLimit = this.xcells * this.ycells;

            this.spaces = [];

            this.getCellToUse = (function(v, q){
                var i = q;
                var p = 0
                while( i < v){
                    p++;
                    i = i + q;
                }
                return p;
            }).bind(this);


            this.onCanvasClick = (function(e){
                var pos = this.getMousePos(e);

                var cposx = this.getCellToUse(pos.x, this.elementWidth);
                var cposy = this.getCellToUse(pos.y, this.elementHeight);

                var placeX = cposx * this.elementWidth;
                var placeY = cposy * this.elementHeight;

                if(!this.spaces[cposx][cposy]){
                    this.drawNextShape(placeX, placeY);
                    this.spaces[cposx][cposy] = true;
                }
            }).bind(this);

            this.initSpaces = (function(){
                this.spaces = [];
                for(var x = 0; x < this.xcells; x++){
                    this.spaces.push([]);
                    for(var y = 0; y <this.ycells; y++){
                        this.spaces[x].push(false);
                    }
                }
            }).bind(this);

            this.draw = (function() {
                if (this.canvas.getContext) {
                    
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    this.initSpaces();
                    this.currentShape = 1;

                    var mesh = new Mesh(this.xcells,this.ycells,this.canvas.width,this.canvas.height);
                    mesh.paint(this.ctx);
                }
            }).bind(this);

            this.getMousePos = (function(evt) {
                var rect = this.canvas.getBoundingClientRect();
                return {
                    x: evt.clientX - rect.left,
                    y: evt.clientY - rect.top
                };
            }).bind(this);        

            this.drawNextShape = (function(x,y){
                if(this.currentShape == 1){
                    var cross = new Cross(x,y, this.elementWidth, this.elementHeight);
                    cross.paint(this.ctx);
                    this.currentShape = 0;
                } else {
                    var circle = new Circle(x, y , this.elementRadius);
                    circle.paint(this.ctx);
                    this.currentShape = 1;                
                }
            }).bind(this);

            this.canvas.addEventListener('click', this.onCanvasClick, false);
            document.getElementById("reset").onclick = this.draw;
            
            return {
                draw: this.draw
            }
    }

    var ticTacToe = new TicTacToe("tictactoe", 3, 3);
    ticTacToe.draw();
    </script>
  </body>
</html>