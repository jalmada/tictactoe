<html>
  <head>
    <meta charset="utf-8"/>
    <title>Canvas tutorial</title>
    
    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
  </head>
  <body onload="draw();">
    <canvas id="tutorial" width="300" height="300"></canvas><br/>
    <button id="reset" onClick ="reset()">Reset</button>
    <script type="text/javascript">


        Circle = function(x,y,radius){
            this.x = x;
            this.y = y;
            this.radius = radius;
            

            this.paint = (function(ctx){
                ctx.strokeStyle = "rgb(0,0,0)";
                ctx.beginPath();
                ctx.arc(this.x + this.radius, this.y + this.radius, this.radius - 12, 0,Math.PI + (Math.PI * 2) / 2, true)
                ctx.stroke();
            }).bind(this);
        }

        Cross = function(x,y,width, height){
            this.x = x + 12;
            this.y = y + 12;
            this.width = width -24;
            this.height = height -24;

            this.paint = (function(ctx){
                ctx.strokeStyle = "rgb(0,0,0)";
                ctx.lineWidth=10;
                ctx.beginPath();
                ctx.moveTo(this.x,this.y);
                ctx.lineTo(this.x + this.width,this.y + this.height);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(this.x + this.width,this.y);
                ctx.lineTo(this.x, this.y + this.height);
                ctx.stroke();
            }).bind(this);

        }

        Square = function(x,y,width,height){
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;

            this.paint = (function(ctx){
                ctx.fillStyle = `rgb(${this.x * 2}, ${this.y * 2}, ${this.width * 2})`;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }).bind(this);           

            return {
                paint: this.paint
            }
        }

        Mesh = function(cellsx, cellsy, width, height){
            this.cellsx = cellsx;
            this.cellsy = cellsy;
            this.width = width;
            this.height = height;

            this.countVLines = cellsx - 1;
            this.countHLines = cellsy - 1;
            this.cellwidth = Math.ceil(width/cellsx);
            this.cellheight = Math.ceil(height/cellsy);

            this.paint = (function(ctx){
                for(var x = 0, xpos = this.cellwidth; x < this.countVLines; x++, xpos = xpos + this.cellwidth){
                    ctx.strokeStyle = "rgb(0,0,0)";
                    ctx.lineWidth=5;
                    ctx.beginPath();
                    ctx.moveTo(xpos,0);
                    ctx.lineTo(xpos, this.height);
                    ctx.stroke();
                }

                for(var y = 0, ypos = this.cellheight; y < this.countHLines; y++, ypos = ypos + this.cellheight){
                    ctx.strokeStyle = "rgb(0,0,0)";
                    ctx.lineWidth=5;
                    ctx.beginPath();
                    ctx.moveTo(0,ypos);
                    ctx.lineTo(this.width, ypos);
                    ctx.stroke();
                }           
            }).bind(this);  
        }

        Grid = function(x, y, width, height){
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;

            this.squares = [];

            this.paint = (function(ctx){
                var swidth = Math.ceil(this.width / this.x);
                var sheight = Math.ceil(this.height / this.y);

                for(y = 0; y < this.height; y = y + sheight){
                    for(x = 0; x < this.width; x = x + swidth){
                        var s = new Square(x,y,swidth,sheight);
                        this.squares.push(s);
                        s.paint(ctx);
                    }
                }
            }).bind(this);

            return {
                paint: this.paint
            }
        }


        var canvas;
        var ctx;

        var xrownum;
        var yrownum;
        var gridWidth;
        var gridHeight;

        var crossesWidth;
        var crossesHeight;
        var circleRadius;

        var currentShape;
        var shapeLimit;

        var spaces = [];

        function initCanvas(){
            canvas = document.getElementById('tutorial');
            canvas.addEventListener('click', function(e) { 
                var pos = getMousePos(canvas, e);

                var w = crossesWidth;
                var multiplierx = 0
                while( w < pos.x){
                    multiplierx++;
                    w = w + crossesWidth;
                }

                var h = crossesHeight;
                var multipliery = 0
                while( h < pos.y){
                    multipliery++;
                    h = h + crossesHeight;
                }

                var placeX = multiplierx * crossesWidth;
                var placeY = multipliery * crossesHeight;

                if(!spaces[multiplierx][multipliery]){
                    drawNextShape(placeX, placeY);
                    spaces[multiplierx][multipliery] = true;
                }
            }, false);
        }

        function draw() {
            if (canvas.getContext) {
                ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                spaces = [];
                

                xrownum = 3;
                yrownum = 3;

                for(var x = 0; x < xrownum; x++){
                    spaces.push([]);
                    for(var y = 0; y <yrownum; y++){
                        spaces[x].push(false);
                    }
                }
                shapeLimit = xrownum * yrownum;
                gridWidth = 300;
                gridHeight = 300;
                currentShape = 1;

                crossesWidth = Math.ceil(gridWidth / xrownum);
                crossesHeight = Math.ceil(gridHeight / yrownum);
                circleRadius = Math.ceil((gridWidth / xrownum)/2);

                var mesh = new Mesh(xrownum,yrownum,gridWidth,gridHeight);
                mesh.paint(ctx);
            }
        }

        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }        

        function reset(){
            draw();
        }

        function drawNextShape(x,y){
            if(currentShape == 1){
                var cross = new Cross(x,y, crossesWidth, crossesHeight);
                cross.paint(ctx);
                currentShape = 0;
            } else {
                var circle = new Circle(x, y , circleRadius);
                circle.paint(ctx);
                currentShape = 1;                
            }
        }

        initCanvas();

    </script>
  </body>
</html>